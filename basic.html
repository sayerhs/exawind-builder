
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Using exawind-builder to build software &#8212; exawind-builder v0.0.1 documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Adding new system configuration" href="newsys.html" />
    <link rel="prev" title="Setting up exawind-builder" href="installation.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="using-exawind-builder-to-build-software">
<span id="basic-usage"></span><h1>Using exawind-builder to build software<a class="headerlink" href="#using-exawind-builder-to-build-software" title="Permalink to this headline">¶</a></h1>
<p>This section describes the basic steps to configure exawind-builder and use the
scripts provided to build software used within the ExaWind project.</p>
<div class="section" id="configuring-exawind-builder">
<span id="exawind-config"></span><h2>Configuring exawind-builder<a class="headerlink" href="#configuring-exawind-builder" title="Permalink to this headline">¶</a></h2>
<p>During execution, exawind-builder reads user configuration from various files
that provide fine-grained control of the build process. The default name for the
configuration file is <code class="docutils literal notranslate"><span class="pre">exawind-config</span></code>, but this can be configured by
modifying the <span class="target" id="index-0"></span><a class="reference internal" href="reference.html#envvar-EXAWIND_CFGFILE"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">EXAWIND_CFGFILE</span></code></a> variable. exawind-builder will load the
following files in the specified order</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/.exawind-config   <span class="c1"># User configuration file</span>
<span class="si">${</span><span class="nv">EXAWIND_CONFIG</span><span class="si">}</span>         <span class="c1"># File pointed to by the variable ${EXAWIND_CONFIG}</span>
<span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/exawind-config.sh  <span class="c1"># File in the local build directory</span>
</pre></div>
</div>
<p>The configuration variables in the subsequent files will override the default
values as well as configuration variables set in the previous files. The second
file <code class="file docutils literal notranslate"><span class="pre">$</span><em><span class="pre">HOME</span></em><span class="pre">/exawind/exawind-config.sh</span></code> assumes that you followed the
standard <a class="reference internal" href="introduction.html#exawind-dir-layout"><span class="std std-ref">Exawind directory structure</span></a>. Please replace the path appropriately
(<span class="target" id="index-1"></span><a class="reference internal" href="reference.html#envvar-EXAWIND_PROJECT_DIR"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">EXAWIND_PROJECT_DIR</span></code></a>), if you used a non-standard location for
installation. See also <span class="target" id="index-2"></span><a class="reference internal" href="reference.html#envvar-EXAWIND_CONFIG"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">EXAWIND_CONFIG</span></code></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol class="arabic simple">
<li><p>It is recommended that the user use local configuration files within build
directories to set variables instead of modifying the build scripts within
the <cite>exawind/scripts</cite> directory.</p></li>
<li><p>If you are using a shared instance of exawind-builder (e.g., on NREL
Peregrine), then please use <code class="file docutils literal notranslate"><span class="pre">exawind-config.sh</span></code> within your build
directory to override common configuration parameters.</p></li>
</ol>
</div>
</div>
<div class="section" id="compiling-software">
<span id="id1"></span><h2>Compiling Software<a class="headerlink" href="#compiling-software" title="Permalink to this headline">¶</a></h2>
<p>If you followed the <em>bootstrap</em> method described in <a class="reference internal" href="installation.html#installation"><span class="std std-ref">Setting up exawind-builder</span></a>, then
you should have build scripts for the different projects installed in
<code class="file docutils literal notranslate"><span class="pre">exawind/scripts</span></code> directory. The scripts are named
<code class="docutils literal notranslate"><span class="pre">$PROJECT-$COMPILER.sh</span></code>. For example, the build script for <code class="docutils literal notranslate"><span class="pre">nalu-wind</span></code>
project on a system using GCC compiler suite will be called
<code class="file docutils literal notranslate"><span class="pre">nalu-wind-gcc.sh</span></code>. With no arguments provided, the script will load all
necessary modules for compiling the code, execute CMake configuration step
followed by <code class="docutils literal notranslate"><span class="pre">make</span></code>.</p>
<p>Compiling software, therefore, consists of the following steps (see detailed
examples of trilinos and nalu-wind in the code snippets below that demonstrate
these steps):</p>
<ol class="arabic simple">
<li><p>Clone the appropriate software repository into <code class="file docutils literal notranslate"><span class="pre">exawind/source</span></code>
directory, e.g., <code class="docutils literal notranslate"><span class="pre">nalu-wind</span></code>. See note below on <code class="docutils literal notranslate"><span class="pre">trilinos</span></code> status for
certain systems.</p></li>
<li><p>Create a CMake build directory. We recommend out-of-source builds for all software.</p></li>
<li><p>Create a symbolic link to the apporpriate build script from
<code class="file docutils literal notranslate"><span class="pre">exawind/scripts</span></code> directory.</p></li>
<li><p>Create <code class="file docutils literal notranslate"><span class="pre">exawind/source/$project/build/exawind-config.sh</span></code>, if necessary,
and set custom variables for this build. Examples include switching to debug
builds, or using different version of dependencies. If the configuration is
applicable to multiple codes that you are building, then consolidate the
common options in <code class="file docutils literal notranslate"><span class="pre">exawind/exawind-config.sh</span></code> to avoid duplication.</p></li>
<li><p>Add an entry in <a class="reference internal" href="#exawind-config"><span class="std std-ref">configuration file</span></a> to override the
default version of software with your custom build version when compiling
other software, e.g., overriding the default version of HYPRE or OpenFAST –
see <span class="target" id="index-3"></span><a class="reference internal" href="reference.html#envvar-PROJECTNAME_ROOT_DIR"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PROJECTNAME_ROOT_DIR</span></code></a> for more details.</p></li>
<li><p>Execute the build script (assuming you’ve all prerequisites, see note on
Trilinos below).</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>On most systems, users will have to install Trilinos and Nalu-Wind manually.
For these systems, users must install Trilinos before attempting to build
<code class="docutils literal notranslate"><span class="pre">nalu-wind</span></code> and set <span class="target" id="index-4"></span><a class="reference internal" href="reference.html#envvar-PROJECTNAME_ROOT_DIR"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">TRILINOS_ROOT_DIR</span></code></a> in
their <a class="reference internal" href="#exawind-config"><span class="std std-ref">configuration file</span></a>. Exceptions to this
requirement are NREL Peregrine, Eagle, and Rhodes systems where Trilinos is
installed and maintained by the ExaWind team (Jon Rood).</p>
</div>
<p>For convenience, the list of commands necesssary to compile trilinos and
nalu-wind are provided below.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Preliminary setup</span>
<span class="c1"># Adjust these variables apporpriately</span>
<span class="nb">export</span> <span class="nv">EXAWIND_PROJECT_DIR</span><span class="o">=</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/exawind/
<span class="nb">export</span> <span class="nv">COMPILER</span><span class="o">=</span>gcc

<span class="c1">#</span>
<span class="c1"># Build trilinos first (if necessary)</span>
<span class="c1">#</span>
<span class="c1"># Clone trilinos</span>
<span class="nb">cd</span> <span class="si">${</span><span class="nv">EXAWIND_PROJECT_DIR</span><span class="si">}</span>/source
<span class="c1"># Clone the repo</span>
git clone https://github.com/trilinos/trilinos.git
<span class="c1"># Create a build directory</span>
mkdir trilinos/build-<span class="si">${</span><span class="nv">COMPILER</span><span class="si">}</span>
<span class="c1"># Switch to build directory</span>
<span class="nb">cd</span> trilinos/build-<span class="si">${</span><span class="nv">COMPILER</span><span class="si">}</span>
<span class="c1"># link the build script (change gcc appropriately)</span>
ln -s <span class="si">${</span><span class="nv">EXAWIND_PROJECT_DIR</span><span class="si">}</span>/scripts/trilinos-<span class="si">${</span><span class="nv">COMPILER</span><span class="si">}</span>.sh
<span class="c1"># Execute the script</span>
./trilinos-<span class="si">${</span><span class="nv">COMPILER</span><span class="si">}</span>.sh
<span class="c1"># Install on successful build</span>
./trilinos-<span class="si">${</span><span class="nv">COMPILER</span><span class="si">}</span>.sh make install
<span class="c1"># Instruct nalu-wind to use the new Trilinos location</span>
<span class="nb">echo</span> <span class="s1">&#39;export TRILINOS_ROOT_DIR=${EXAWIND_INSTALL_DIR}/trilinos&#39;</span> &gt;&gt; <span class="si">${</span><span class="nv">EXAWIND_PROJECT_DIR</span><span class="si">}</span>/exawind-config.sh

<span class="c1">#</span>
<span class="c1"># Build nalu-wind</span>
<span class="c1">#</span>
<span class="c1"># Clone nalu-wind</span>
<span class="nb">cd</span> <span class="si">${</span><span class="nv">EXAWIND_PROJECT_DIR</span><span class="si">}</span>/source
git clone https://github.com/exawind/nalu-wind.git
<span class="c1"># Create a build directory</span>
mkdir nalu-wind/build-<span class="si">${</span><span class="nv">COMPILER</span><span class="si">}</span>
<span class="c1"># Switch to build directory</span>
<span class="nb">cd</span> nalu-wind/build-<span class="si">${</span><span class="nv">COMPILER</span><span class="si">}</span>
<span class="c1"># link the build script (change gcc appropriately)</span>
ln -s <span class="si">${</span><span class="nv">EXAWIND_PROJECT_DIR</span><span class="si">}</span>/scripts/nalu-wind-<span class="si">${</span><span class="nv">COMPILER</span><span class="si">}</span>.sh
<span class="c1"># Execute the script</span>
./nalu-wind-<span class="si">${</span><span class="nv">COMPILER</span><span class="si">}</span>.sh
<span class="c1"># Install on successful build</span>
./nalu-wind-<span class="si">${</span><span class="nv">COMPILER</span><span class="si">}</span>.sh make install
</pre></div>
</div>
<div class="section" id="available-tasks-in-the-build-script">
<h3>Available tasks in the build script<a class="headerlink" href="#available-tasks-in-the-build-script" title="Permalink to this headline">¶</a></h3>
<p>The user can control which tasks are executed by providing additional parameters
to the script upon invocation as shown below:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./nalu-wind-gcc.sh <span class="o">[</span>TASK<span class="o">]</span> <span class="o">[</span>ARGUMENTS<span class="o">]</span>
</pre></div>
</div>
<p>The available <strong>tasks</strong> are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cmake</span></code>: Configure the project using CMake and generate build files. By
default, it generates GNU Makefiles.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cmake_full</span></code>: Remove <code class="file docutils literal notranslate"><span class="pre">CMakeCache.txt</span></code> and <code class="file docutils literal notranslate"><span class="pre">CMakeFiles</span></code> before
executing CMake configuration step.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">make</span></code>:  Build the project libraries and executables.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ctest</span></code>: Execute CTest for this project.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">run</span></code>: Run arbitrary shell command within the same environment (modules and
dependencies loaded) as when the project was compiled.</p></li>
</ul>
<p>User can control the behavior of these
tasks by passing extra <code class="docutils literal notranslate"><span class="pre">[ARGUMENTS]</span></code> that are passed directly to the task
invoked. Some examples are shown below</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Change CMake build type to DEBUG and turn on shared library build</span>
./nalu-wind-gcc.sh cmake -DCMAKE_BUILD_TYPE<span class="o">=</span>DEBUG -DBUILD_SHARED_LIBS<span class="o">=</span>ON

<span class="c1"># Turn on verbose output with make and only build naluX (and not unittestX)</span>
./nalu-wind-gcc.sh make <span class="nv">VERBOSE</span><span class="o">=</span><span class="m">1</span> naluX

<span class="c1"># Only execute one regression test and enable output on failure</span>
./nalu-wind-gcc.sh ctest --output-on-failure -R ablNeutralEdge
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>By default, <code class="docutils literal notranslate"><span class="pre">make</span></code> will execute several jobs in parallel. Users can
control the maximum number of parallel jobs by either setting the
environment variable <span class="target" id="index-5"></span><a class="reference internal" href="reference.html#envvar-EXAWIND_NUM_JOBS"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">EXAWIND_NUM_JOBS</span></code></a> within the build script, or
using <code class="docutils literal notranslate"><span class="pre">./nalu-wind-gcc.sh</span> <span class="pre">make</span> <span class="pre">-j</span> <span class="pre">12</span></code> to override the defaults.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cmake_full</span></code> accepts all valid CMake arguments that <code class="docutils literal notranslate"><span class="pre">cmake</span></code> command does.</p></li>
<li><p>The <code class="file docutils literal notranslate"><span class="pre">cmake_output.log</span></code> within the build directory contains the output
of the last <cite>cmake</cite> command that was executed. This output is also echoed
to the screen.</p></li>
<li><p>The <code class="file docutils literal notranslate"><span class="pre">make_output.log</span></code> contains the output from the last invocation of
<code class="docutils literal notranslate"><span class="pre">make</span></code>. This output is also simultaneously echoed to the screen.</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="customizing-the-build-process">
<span id="build-custom"></span><h2>Customizing the build process<a class="headerlink" href="#customizing-the-build-process" title="Permalink to this headline">¶</a></h2>
<p>The previous section showed how the execution of CMake and Make can be
customized to a limited extent by passing command line arguments with specific
tasks. However, for more complex customizations it is recommended that the user
use the <a class="reference internal" href="#exawind-config"><span class="std std-ref">configuration file</span></a> to control the build process.
This approach allows the user to consolidate common build options, e.g.,
enabling/disabling OpenMP/CUDA, release/debug builds across all projects
consistently through the <code class="file docutils literal notranslate"><span class="pre">exawind/exawind-config.sh</span></code> and fine tuning
options from the config file within the current working directory. This will
allow the user to repeat the build process consistently during development and
aid in debugging when things don’t work as expected. The various customizations
possible are described below.</p>
<div class="section" id="customizing-module-load">
<h3>Customizing module load<a class="headerlink" href="#customizing-module-load" title="Permalink to this headline">¶</a></h3>
<p><cite>exawind-builder`</cite> provides a default list of modules on most systems that work
for most use cases. However, the user might desire to use different modules for
their custom builds. This is achieved by configuring the modules to be loaded in
the <span class="target" id="index-6"></span><a class="reference internal" href="reference.html#envvar-EXAWIND_MODMAP"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">EXAWIND_MODMAP</span></code></a> variable. For example, on NREL Peregrine the
default Trilinos build does not enable OpenMP support. In this case, the user
can replace the default <code class="docutils literal notranslate"><span class="pre">trilinos/develop</span></code> module by specifying the following
in the <a class="reference internal" href="#exawind-config"><span class="std std-ref">configuration file</span></a>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use OpenMP enabled version of trilinos module on Peregrine</span>
EXAWIND_MODMAP<span class="o">[</span>trilinos<span class="o">]=</span>trilinos/develop-omp
</pre></div>
</div>
</div>
<div class="section" id="enabling-disabling-tpls">
<h3>Enabling/Disabling TPLs<a class="headerlink" href="#enabling-disabling-tpls" title="Permalink to this headline">¶</a></h3>
<p>See project-specific documentation in <a class="reference internal" href="reference.html#reference"><span class="std std-ref">Reference</span></a> to see what variables can
be used to enable/disable various options for different projects.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Control OpenMP and CUDA</span>
<span class="nv">ENABLE_OPENMP</span><span class="o">=</span>ON
<span class="nv">ENABLE_CUDA</span><span class="o">=</span>OFF

<span class="c1"># Set debug/release options</span>
<span class="nv">BUILD_TYPE</span><span class="o">=</span>RELEASE

<span class="c1"># Disable TIOGA and OpenFAST, but enable HYPRE when building Nalu-Wind</span>
<span class="nv">ENABLE_TIOGA</span><span class="o">=</span>OFF
<span class="nv">ENABLE_OPENFAST</span><span class="o">=</span>OFF
<span class="nv">ENABLE_HYPRE</span><span class="o">=</span>ON
</pre></div>
</div>
</div>
<div class="section" id="using-custom-builds-of-libraries">
<h3>Using custom builds of libraries<a class="headerlink" href="#using-custom-builds-of-libraries" title="Permalink to this headline">¶</a></h3>
<p>During development, the user might desire to use a different branch of a
dependency than what the default system-wide installation provides. For example,
the user might want to use a different branch of OpenFAST when developing
advanced FSI capability within Nalu-Wind. The user can bypass the module
search/load process by defining <span class="target" id="index-7"></span><a class="reference internal" href="reference.html#envvar-PROJECTNAME_ROOT_DIR"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">ROOT_DIR</span></code></a>
variable for the corresponding dependency. The following example shows how to
customize the TPLs used for building nalu-wind</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Always provide our own Trilinos build</span>
<span class="nb">export</span> <span class="nv">TRILINOS_ROOT_DIR</span><span class="o">=</span><span class="si">${</span><span class="nv">EXAWIND_INSTALL_DIR</span><span class="si">}</span>/trilinos

<span class="c1"># Override TPLs used to build nalu-wind</span>
<span class="nb">export</span> <span class="nv">OPENFAST_ROOT_DIR</span><span class="o">=</span><span class="si">${</span><span class="nv">EXAWIND_INSTALL_DIR</span><span class="si">}</span>/openfast-dbg
<span class="nb">export</span> <span class="nv">HYPRE_ROOT_DIR</span><span class="o">=</span><span class="si">${</span><span class="nv">EXAWIND_INSTALL_DIR</span><span class="si">}</span>/hypre-omp
</pre></div>
</div>
</div>
<div class="section" id="overriding-default-behavior">
<h3>Overriding default behavior<a class="headerlink" href="#overriding-default-behavior" title="Permalink to this headline">¶</a></h3>
<p>In rare circumstances, it will be necessary for the user to create a copy of the
build script and edit it manually to customize the build. A build script with
default parameters is shown below:</p>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#</span>
<span class="c1"># ExaWind build script for project: trilinos</span>
<span class="c1">#</span>
<span class="c1"># Autogenerated for peregrine and gcc</span>
<span class="c1">#</span>
<span class="c1"># 1. See https://exawind.github.io/exawind-builder for documentation</span>
<span class="c1"># 2. Use new-script.sh to regenerate this script</span>
<span class="c1">#</span>

<span class="c1">#</span>
<span class="c1"># Setup variables used by functions</span>
<span class="c1">#</span>
<span class="nb">export</span> <span class="nv">EXAWIND_SRCDIR</span><span class="o">=</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/exawind/exawind-builder
<span class="nb">export</span> <span class="nv">EXAWIND_COMPILER</span><span class="o">=</span>gcc
<span class="nb">export</span> <span class="nv">EXAWIND_SYSTEM</span><span class="o">=</span>peregrine
<span class="nb">export</span> <span class="nv">EXAWIND_CODE</span><span class="o">=</span>trilinos
<span class="nb">export</span> <span class="nv">EXAWIND_CFGFILE</span><span class="o">=</span>exawind-config

<span class="c1">#</span>
<span class="c1"># Source the core, system, and project specific build scripts</span>
<span class="c1">#</span>
<span class="nb">source</span> <span class="si">${</span><span class="nv">EXAWIND_SRCDIR</span><span class="si">}</span>/core.bash
<span class="nb">source</span> <span class="si">${</span><span class="nv">EXAWIND_SRCDIR</span><span class="si">}</span>/envs/<span class="si">${</span><span class="nv">EXAWIND_SYSTEM</span><span class="si">}</span>.bash
<span class="nb">source</span> <span class="si">${</span><span class="nv">EXAWIND_SRCDIR</span><span class="si">}</span>/codes/<span class="si">${</span><span class="nv">EXAWIND_CODE</span><span class="si">}</span>.bash

<span class="c1"># Path to ExaWind project and install directories</span>
<span class="nb">export</span> <span class="nv">EXAWIND_PROJECT_DIR</span><span class="o">=</span><span class="si">${</span><span class="nv">EXAWIND_PROJECT_DIR</span><span class="k">:-</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="p">/exawind</span><span class="si">}</span>
<span class="nb">export</span> <span class="nv">EXAWIND_INSTALL_DIR</span><span class="o">=</span><span class="si">${</span><span class="nv">EXAWIND_INSTALL_DIR</span><span class="k">:-</span><span class="si">${</span><span class="nv">EXAWIND_PROJECT_DIR</span><span class="si">}</span><span class="p">/install</span><span class="si">}</span>
<span class="nb">export</span> <span class="nv">EXAWIND_CONFIG</span><span class="o">=</span><span class="si">${</span><span class="nv">EXAWIND_CONFIG</span><span class="k">:-</span><span class="si">${</span><span class="nv">EXAWIND_PROJECT_DIR</span><span class="si">}</span><span class="p">/</span><span class="si">${</span><span class="nv">EXAWIND_CFGFILE</span><span class="si">}</span><span class="p">.sh</span><span class="si">}</span>

<span class="c1"># Source any user specific configuration (see documentation)</span>
exawind_load_user_configs

<span class="c1"># Path to the source directory (absolute or relative to build directory)</span>
<span class="nv">TRILINOS_SOURCE_DIR</span><span class="o">=</span><span class="si">${</span><span class="nv">TRILINOS_SOURCE_DIR</span><span class="k">:-</span><span class="p">..</span><span class="si">}</span>
<span class="c1"># Path where `make install` will install files for this project</span>
<span class="nv">TRILINOS_INSTALL_PREFIX</span><span class="o">=</span><span class="si">${</span><span class="nv">TRILINOS_INSTALL_PREFIX</span><span class="k">:-</span><span class="si">${</span><span class="nv">EXAWIND_INSTALL_DIR</span><span class="si">}</span><span class="p">/trilinos</span><span class="si">}</span>

<span class="c1">########## BEGIN user specific configuration ###########</span>

<span class="c1">########## END user specific configuration   ###########</span>

<span class="c1">### Execute main function (must be last line of this script)</span>
<span class="k">if</span> <span class="o">[[</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="si">}</span><span class="s2">&quot;</span> !<span class="o">=</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">0</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">]]</span> <span class="p">;</span> <span class="k">then</span>
    exawind_env <span class="o">&amp;&amp;</span> exawind_proj_env
<span class="k">else</span>
    exawind_main <span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table></div>
<p>The struture of the build script is the same regardless of the machine,
compiler, or the project that is being built. Lines 14-36 setup the variables
and functions necessary to detect dependencies and build the software, please do
not edit these lines unless you know what you are doing. Lines 45-49 should not
be modified either, and must always be the end of the script. Lines added to the
script after this section will not affect the configure and build process. User
specific configuration and customization should occur within the block indicated
by lines 40-42. User might want to configure the
<span class="target" id="index-8"></span><a class="reference internal" href="reference.html#envvar-PROJECTNAME_INSTALL_PREFIX"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PROJECTNAME_INSTALL_PREFIX</span></code></a> (line 38) when building different
configurations (e.g., release/debug versions, with and without OpenMP, etc.) so
as to have different builds side by side. It is, however, recommended that the
user customize this variable in the <code class="file docutils literal notranslate"><span class="pre">exawind-config.sh</span></code> local to the build
directory.</p>
<p>A good example of what should go in the build script and not the configuration
file is described in the next section. Since bash functions are often project
specific they should be overridden in the build script and not the configuration
file.</p>
<div class="section" id="customizing-exawind-environment">
<h4>Customizing ExaWind environment<a class="headerlink" href="#customizing-exawind-environment" title="Permalink to this headline">¶</a></h4>
<p>The builder provides two additional options that allows the user to further
configure the default environment that is enabled for a given system/compiler
combination.</p>
<ol class="arabic">
<li><p>To load additional modules, the user can use
<span class="target" id="index-9"></span><a class="reference internal" href="reference.html#envvar-EXAWIND_EXTRA_USER_MODULES"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">EXAWIND_EXTRA_USER_MODULES</span></code></a> variable to orovide the list of modules
(in module or spack syntax as appropriate) and have them loaded after the
base modules have been loaded.</p></li>
<li><p>Fine-grained customization is achieved by defining by overriding the function
<a class="reference internal" href="reference.html#exawind_env_user_actions" title="exawind_env_user_actions"><code class="xref py py-func docutils literal notranslate"><span class="pre">exawind_env_user_actions()</span></code></a> in the <code class="file docutils literal notranslate"><span class="pre">exawind-config.sh</span></code> configuration
file.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load additional modules and print out some variables</span>
exawind_env_user_actions <span class="o">()</span>
<span class="o">{</span>
  module load paraview
  <span class="nb">echo</span> <span class="si">${</span><span class="nv">CXX</span><span class="si">}</span>
  <span class="nb">echo</span> <span class="si">${</span><span class="nv">TRILINOS_ROOT_DIR</span><span class="si">}</span>
<span class="o">}</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="customizing-cmake-configuration-phase">
<h4>Customizing CMake configuration phase<a class="headerlink" href="#customizing-cmake-configuration-phase" title="Permalink to this headline">¶</a></h4>
<p>To always pass certain variables, the user can customize the <code class="docutils literal notranslate"><span class="pre">exawind_cmake</span></code>
function with their own version that adds the extra options permanently every
time <code class="docutils literal notranslate"><span class="pre">cmake</span></code> is executed. For example, to build <code class="docutils literal notranslate"><span class="pre">nalu-wind</span></code> with ParaView
Catalyst support:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">########## BEGIN user specific configuration ###########</span>

<span class="c1"># Customize cmake with extra arguments</span>
exawind_cmake <span class="o">()</span>
<span class="o">{</span>
    <span class="nb">local</span> <span class="nv">extra_args</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>

    exawind_cmake_base <span class="se">\</span>
        -DENABLE_PARAVIEW_CATALYST:BOOL<span class="o">=</span>ON <span class="se">\</span>
        -DPARAVIEW_CATALYST_INSTALL_PATH:PATH<span class="o">=</span><span class="si">${</span><span class="nv">PV_CATALYST_PATH</span><span class="si">}</span> <span class="se">\</span>
        <span class="si">${</span><span class="nv">extra_args</span><span class="si">}</span>
<span class="o">}</span>

<span class="c1">########## END user specific configuration   ###########</span>
</pre></div>
</div>
<p>With the above changes, ParaView Catalyst support will always be enabled during
builds. The user still has the option to pass additional parameters through the
command line also for a one-off customization.</p>
</div>
</div>
</div>
<div class="section" id="activating-exawind-environment-for-job-submissions">
<span id="exawind-env"></span><h2>Activating ExaWind environment for job submissions<a class="headerlink" href="#activating-exawind-environment-for-job-submissions" title="Permalink to this headline">¶</a></h2>
<p>In addition to the build scripts, the <em>bootstrap</em> installation process also
creates a file called <code class="file docutils literal notranslate"><span class="pre">exawind/scripts/exawind-env-$COMPILER.sh</span></code> which can
be <em>sourced</em> to recreate the environment that was used to build the codes. User
can use this to setup the apporpriate environment in a job submission script, or
during interactive work, by simply sourcing this script.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the default modules (e.g., MPI)</span>
<span class="nb">source</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/exawind/scripts/exawind-env-gcc.sh
</pre></div>
</div>
<p>In addition to loading the default modules, sourcing this file will also
introduce a bash command <code class="docutils literal notranslate"><span class="pre">exawind_load_deps</span></code> that can be used to load
additional modules within the bash environment. For example, to access
<code class="docutils literal notranslate"><span class="pre">ncdump</span></code> available in the <code class="docutils literal notranslate"><span class="pre">netcdf</span></code> module on any system, the user can
execute the following</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Activate exawind environment</span>
<span class="nb">source</span> <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/exawind/scripts/exawind-env-gcc.sh
<span class="c1"># load the NetCDF module or spack build</span>
exawind_load_deps netcdf

<span class="c1"># Now ncdump should be available in your PATH</span>
ncdump -h &lt;exodus_file&gt;
</pre></div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">exawind-builder</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Setting up exawind-builder</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Using exawind-builder to build software</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#configuring-exawind-builder">Configuring exawind-builder</a></li>
<li class="toctree-l2"><a class="reference internal" href="#compiling-software">Compiling Software</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#available-tasks-in-the-build-script">Available tasks in the build script</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#customizing-the-build-process">Customizing the build process</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#customizing-module-load">Customizing module load</a></li>
<li class="toctree-l3"><a class="reference internal" href="#enabling-disabling-tpls">Enabling/Disabling TPLs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-custom-builds-of-libraries">Using custom builds of libraries</a></li>
<li class="toctree-l3"><a class="reference internal" href="#overriding-default-behavior">Overriding default behavior</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#customizing-exawind-environment">Customizing ExaWind environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#customizing-cmake-configuration-phase">Customizing CMake configuration phase</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#activating-exawind-environment-for-job-submissions">Activating ExaWind environment for job submissions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="newsys.html">Adding new system configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced.html">Manual Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="installation.html" title="previous chapter">Setting up exawind-builder</a></li>
      <li>Next: <a href="newsys.html" title="next chapter">Adding new system configuration</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, ExaWind Project.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/basic.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>